{% extends 'base_new.html' %}

{% block title %}Push Subscriptions - CSU Tracker{% endblock %}

{% block header_title %}Your Devices{% endblock %}

{% block header_left %}
<a href="{% url 'notifications:settings' %}" class="btn btn--icon btn--ghost" aria-label="Back to settings">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M15 18l-6-6 6-6"/>
    </svg>
</a>
{% endblock %}

{% block content %}
<div class="app-content fade-in">
    <p class="text-secondary mb-5">Manage push notification subscriptions</p>
    
    {% if subscriptions %}
    <div class="card">
        <div class="card__body card__body--compact">
            {% for sub in subscriptions %}
            <div class="flex items-start justify-between py-4 {% if not forloop.last %}border-b{% endif %}" style="border-color: var(--border-subtle);">
                <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2 mb-1">
                        <span class="badge {% if sub.is_active %}badge--success{% else %}badge--neutral{% endif %}">
                            {% if sub.is_active %}Active{% else %}Inactive{% endif %}
                        </span>
                    </div>
                    <p class="text-sm text-secondary truncate" title="{{ sub.user_agent }}">
                        {{ sub.user_agent|truncatechars:50 }}
                    </p>
                    <p class="text-xs text-tertiary mt-1">
                        Added {{ sub.created_at|date:"M j, Y" }}
                    </p>
                </div>
                <form method="post" action="{% url 'notifications:delete_subscription' sub.id %}" class="ml-3">
                    {% csrf_token %}
                    <button type="submit" class="btn btn--icon btn--ghost btn--destructive" aria-label="Delete subscription">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6"/>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                            <line x1="10" y1="11" x2="10" y2="17"/>
                            <line x1="14" y1="11" x2="14" y2="17"/>
                        </svg>
                    </button>
                </form>
            </div>
            {% endfor %}
        </div>
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-state__icon">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
                <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
            </svg>
        </div>
        <h3 class="empty-state__title">No Subscriptions</h3>
        <p class="empty-state__description">You haven't enabled push notifications on any device yet.</p>
        <a href="{% url 'notifications:settings' %}" class="btn btn--primary mt-4">Enable Notifications</a>
    </div>
    {% endif %}
</div>
{% endblock %}
