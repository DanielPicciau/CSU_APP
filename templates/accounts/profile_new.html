{% extends 'base_new.html' %}
{% load static %}

{% block title %}Profile - CSU Tracker{% endblock %}

{% block extra_head %}
<style>
.profile-header {
    text-align: center;
    padding: var(--space-6) var(--space-4);
    background: linear-gradient(180deg, var(--color-primary-50) 0%, transparent 100%);
    margin: calc(-1 * var(--space-4)) calc(-1 * var(--space-4)) var(--space-5);
    padding-top: calc(var(--space-6) + var(--safe-area-top));
}
[data-theme="dark"] .profile-header {
    background: linear-gradient(180deg, var(--color-primary-900) 0%, transparent 100%);
}
@media (prefers-color-scheme: dark) {
    :root:not([data-theme="light"]) .profile-header {
        background: linear-gradient(180deg, var(--color-primary-900) 0%, transparent 100%);
    }
}
.profile-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--color-primary-500), var(--color-primary-700));
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto var(--space-4);
    box-shadow: var(--shadow-lg);
}
.profile-avatar__text {
    font-size: 2rem;
    font-weight: 700;
    color: white;
}
.profile-name {
    font-size: var(--text-xl);
    font-weight: 700;
    color: var(--text-primary);
}
.profile-email {
    font-size: var(--text-sm);
    color: var(--text-secondary);
    margin-top: var(--space-1);
}
.profile-stats {
    display: flex;
    justify-content: center;
    gap: var(--space-6);
    margin-top: var(--space-4);
    padding-top: var(--space-4);
    border-top: 1px solid var(--border-subtle);
}
.profile-stat {
    text-align: center;
}
.profile-stat__value {
    font-size: var(--text-2xl);
    font-weight: 700;
    color: var(--text-primary);
}
.profile-stat__label {
    font-size: var(--text-xs);
    color: var(--text-tertiary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.section-title {
    font-size: var(--text-xs);
    font-weight: 600;
    color: var(--text-tertiary);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    padding: 0 var(--space-1);
    margin-bottom: var(--space-3);
}

.form-section {
    background: var(--bg-primary);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-xl);
    padding: var(--space-5);
    margin-bottom: var(--space-5);
}

.score-scale-options {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
}
.score-scale-option {
    display: flex;
    align-items: flex-start;
    gap: var(--space-3);
    padding: var(--space-4);
    border: 2px solid var(--border-subtle);
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: all var(--transition-fast);
}
.score-scale-option:has(input:checked) {
    border-color: var(--color-primary-500);
    background: var(--color-primary-50);
}
[data-theme="dark"] .score-scale-option:has(input:checked) {
    background: var(--color-primary-900);
}
.score-scale-option input {
    margin-top: 2px;
    accent-color: var(--color-primary-500);
}
.score-scale-option__content {
    flex: 1;
}
.score-scale-option__title {
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--space-1);
}
.score-scale-option__desc {
    font-size: var(--text-sm);
    color: var(--text-secondary);
}
</style>
{% endblock %}

{% block header_left %}
<a href="{% url 'notifications:settings' %}" class="btn btn--icon btn--ghost" aria-label="Back to settings">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
    </svg>
</a>
{% endblock %}

{% block header_title %}Profile{% endblock %}

{% block content %}
<div class="app-content">
    
    <!-- Profile Header -->
    <div class="profile-header">
        <div class="profile-avatar">
            <span class="profile-avatar__text">{{ profile.initials }}</span>
        </div>
        <h2 class="profile-name">{{ profile.display_name_or_email }}</h2>
        <p class="profile-email">{{ user.email }}</p>
        
        <div class="profile-stats">
            <div class="profile-stat">
                <div class="profile-stat__value">{{ total_entries }}</div>
                <div class="profile-stat__label">Entries</div>
            </div>
            <div class="profile-stat">
                <div class="profile-stat__value">{{ user.date_joined|timesince }}</div>
                <div class="profile-stat__label">Member</div>
            </div>
        </div>
    </div>
    
    <!-- Profile Form -->
    <form method="post">
        {% csrf_token %}
        
        <!-- Personal Info -->
        <h3 class="section-title">Personal Info</h3>
        <div class="form-section">
            <div class="form-group">
                <label class="form-label" for="id_display_name">Display Name</label>
                {{ form.display_name }}
                <p class="form-helper">Optional - used for greetings and exports</p>
            </div>
            
            <div class="form-group mb-0">
                <label class="form-label">Email</label>
                <input type="email" class="form-input" value="{{ user.email }}" disabled>
                <p class="form-helper">Contact support to change your email</p>
            </div>
        </div>
        
        <!-- Preferences -->
        <h3 class="section-title">Preferences</h3>
        <div class="form-section">
            <div class="form-group">
                <label class="form-label" for="id_default_timezone">Timezone</label>
                {{ form.default_timezone }}
                <p class="form-helper">Used for reminders and daily tracking</p>
            </div>
            
            <div class="form-group mb-0">
                <label class="form-label">Preferred Score Input</label>
                <div class="score-scale-options">
                    {% for choice in form.preferred_score_scale %}
                    <label class="score-scale-option">
                        {{ choice.tag }}
                        <div class="score-scale-option__content">
                            {% if choice.choice_value == "0-6" %}
                            <div class="score-scale-option__title">Combined UAS Score (0-6)</div>
                            <div class="score-scale-option__desc">Single slider for combined itch + hive score. Faster logging.</div>
                            {% else %}
                            <div class="score-scale-option__title">Separate Scores (0-3 each)</div>
                            <div class="score-scale-option__desc">Individual sliders for itch and hive count. More detailed.</div>
                            {% endif %}
                        </div>
                    </label>
                    {% endfor %}
                </div>
            </div>
        </div>
        
        <!-- Quick Links -->
        <h3 class="section-title">Quick Access</h3>
        <div class="form-section" style="padding: 0;">
            <a href="{% url 'tracking:export' %}" class="card__body card__body--compact flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    <span class="font-medium text-primary">Export My Data</span>
                </div>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--text-tertiary)" stroke-width="2">
                    <path d="M9 18l6-6-6-6"/>
                </svg>
            </a>
            <a href="{% url 'accounts:mfa_setup' %}" class="card__body card__body--compact flex items-center justify-between border-t">
                <div class="flex items-center gap-3">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                    </svg>
                    <span class="font-medium text-primary">Set up MFA</span>
                </div>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--text-tertiary)" stroke-width="2">
                    <path d="M9 18l6-6-6-6"/>
                </svg>
            </a>
        </div>
        
        <!-- Save Button -->
        <button type="submit" class="btn btn--primary btn--full mt-5">
            Save Changes
        </button>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/components.js' %}"></script>
{% endblock %}
